// Generated by CoffeeScript 1.6.3
/*
   Stomp Over WebSocket http://www.jmesnil.net/stomp-websocket/doc/ | Apache License V2.0

   Copyright (C) 2010-2013 [Jeff Mesnil](http://jmesnil.net/)
   Copyright (C) 2012 [FuseSource, Inc.](http://fusesource.com)
*/
!function(){var t,e,n,i,o={}.hasOwnProperty,r=[].slice;t={LF:"\n",NULL:"\0"};n=function(){var e;function n(t,e,n){this.command=t;this.headers=e!=null?e:{};this.body=n!=null?n:""}n.prototype.toString=function(){var e,n,i,r;e=[this.command];r=this.headers;for(n in r){if(!o.call(r,n))continue;i=r[n];e.push(""+n+":"+i)}if(this.body){e.push("content-length:"+(""+this.body).length)}e.push(t.LF+this.body);return e.join(t.LF)};e=function(e){var i,o,r,s,u,a,c,f,d,h,l,p,b,g,m,v,y;s=e.search(RegExp(""+t.LF+t.LF));u=e.substring(0,s).split(t.LF);r=u.shift();a={};p=function(t){return t.replace(/^\s+|\s+$/g,"")};v=u.reverse();for(b=0,m=v.length;b<m;b++){h=v[b];f=h.indexOf(":");a[p(h.substring(0,f))]=p(h.substring(f+1))}i="";l=s+2;if(a["content-length"]){d=parseInt(a["content-length"]);i=(""+e).substring(l,l+d)}else{o=null;for(c=g=l,y=e.length;l<=y?g<y:g>y;c=l<=y?++g:--g){o=e.charAt(c);if(o===t.NULL){break}i+=o}}return new n(r,a,i)};n.unmarshall=function(n){var i;return function(){var o,r,s,u;s=n.split(RegExp(""+t.NULL+t.LF+"*"));u=[];for(o=0,r=s.length;o<r;o++){i=s[o];if((i!=null?i.length:void 0)>0){u.push(e(i))}}return u}()};n.marshall=function(e,i,o){var r;r=new n(e,i,o);return r.toString()+t.NULL};return n}();e=function(){var e;function o(t){this.ws=t;this.ws.binaryType="arraybuffer";this.counter=0;this.connected=false;this.heartbeat={outgoing:1e4,incoming:1e4};this.maxWebSocketFrameSize=16*1024;this.subscriptions={}}o.prototype.debug=function(t){var e;return typeof window!=="undefined"&&window!==null?(e=window.console)!=null?e.log(t):void 0:void 0};e=function(){return Date.now||(new Date).valueOf};o.prototype._transmit=function(t,e,i){var o;o=n.marshall(t,e,i);if(typeof this.debug==="function"){this.debug(">>> "+o)}while(true){if(o.length>this.maxWebSocketFrameSize){this.ws.send(o.substring(0,this.maxWebSocketFrameSize));o=o.substring(this.maxWebSocketFrameSize);if(typeof this.debug==="function"){this.debug("remaining = "+o.length)}}else{return this.ws.send(o)}}};o.prototype._setupHeartbeat=function(n){var o,r,s,u,a,c,f=this;if((a=n.version)!==i.VERSIONS.V1_1&&a!==i.VERSIONS.V1_2){return}c=function(){var t,e,i,o;i=n["heart-beat"].split(",");o=[];for(t=0,e=i.length;t<e;t++){u=i[t];o.push(parseInt(u))}return o}(),r=c[0],o=c[1];if(!(this.heartbeat.outgoing===0||o===0)){s=Math.max(this.heartbeat.outgoing,o);if(typeof this.debug==="function"){this.debug("send PING every "+s+"ms")}this.pinger=typeof window!=="undefined"&&window!==null?window.setInterval(function(){f.ws.send(t.LF);return typeof f.debug==="function"?f.debug(">>> PING"):void 0},s):void 0}if(!(this.heartbeat.incoming===0||r===0)){s=Math.max(this.heartbeat.incoming,r);if(typeof this.debug==="function"){this.debug("check PONG every "+s+"ms")}return this.ponger=typeof window!=="undefined"&&window!==null?window.setInterval(function(){var t;t=e()-f.serverActivity;if(t>s*2){if(typeof f.debug==="function"){f.debug("did not receive server activity for the last "+t+"ms")}return f.ws.close()}},s):void 0}};o.prototype._parseConnect=function(){var t,e,n,i;t=1<=arguments.length?r.call(arguments,0):[];i={};switch(t.length){case 2:i=t[0],e=t[1];break;case 3:if(t[1]instanceof Function){i=t[0],e=t[1],n=t[2]}else{i.login=t[0],i.passcode=t[1],e=t[2]}break;case 4:i.login=t[0],i.passcode=t[1],e=t[2],n=t[3];break;default:i.login=t[0],i.passcode=t[1],e=t[2],n=t[3],i.vhost=t[4]}return[i,e,n]};o.prototype.connect=function(){var o,s,u,a,c=this;o=1<=arguments.length?r.call(arguments,0):[];a=this._parseConnect.apply(this,o);u=a[0],this.connectCallback=a[1],s=a[2];if(typeof this.debug==="function"){this.debug("Opening Web Socket...")}this.ws.onmessage=function(i){var o,r,u,a,f,d,h,l,p,b,g,m;a=typeof ArrayBuffer!=="undefined"&&i.data instanceof ArrayBuffer?(o=new Uint8Array(i.data),typeof c.debug==="function"?c.debug("--- got data length: "+o.length):void 0,function(){var t,e,n;n=[];for(t=0,e=o.length;t<e;t++){r=o[t];n.push(String.fromCharCode(r))}return n}().join("")):i.data;c.serverActivity=e();if(a===t.LF){if(typeof c.debug==="function"){c.debug("<<< PONG")}return}if(typeof c.debug==="function"){c.debug("<<< "+a)}g=n.unmarshall(a);m=[];for(p=0,b=g.length;p<b;p++){f=g[p];switch(f.command){case"CONNECTED":if(typeof c.debug==="function"){c.debug("connected to server "+f.headers.server)}c.connected=true;c._setupHeartbeat(f.headers);m.push(typeof c.connectCallback==="function"?c.connectCallback(f):void 0);break;case"MESSAGE":l=f.headers.subscription;h=c.subscriptions[l]||c.onreceive;if(h){u=c;d=f.headers["message-id"];f.ack=function(t){if(t==null){t={}}return u.ack(d,l,t)};f.nack=function(t){if(t==null){t={}}return u.nack(d,l,t)};m.push(h(f))}else{m.push(typeof c.debug==="function"?c.debug("Unhandled received MESSAGE: "+f):void 0)}break;case"RECEIPT":m.push(typeof c.onreceipt==="function"?c.onreceipt(f):void 0);break;case"ERROR":m.push(typeof s==="function"?s(f):void 0);break;default:m.push(typeof c.debug==="function"?c.debug("Unhandled frame: "+f):void 0)}}return m};this.ws.onclose=function(){var t;t="Whoops! Lost connection to "+c.ws.url;if(typeof c.debug==="function"){c.debug(t)}c._cleanUp();return typeof s==="function"?s(t):void 0};return this.ws.onopen=function(){if(typeof c.debug==="function"){c.debug("Web Socket Opened...")}u["accept-version"]=i.VERSIONS.supportedVersions();u["heart-beat"]=[c.heartbeat.outgoing,c.heartbeat.incoming].join(",");return c._transmit("CONNECT",u)}};o.prototype.disconnect=function(t){this._transmit("DISCONNECT");this.ws.onclose=null;this.ws.close();this._cleanUp();return typeof t==="function"?t():void 0};o.prototype._cleanUp=function(){this.connected=false;if(this.pinger){if(typeof window!=="undefined"&&window!==null){window.clearInterval(this.pinger)}}if(this.ponger){return typeof window!=="undefined"&&window!==null?window.clearInterval(this.ponger):void 0}};o.prototype.send=function(t,e,n){if(e==null){e={}}if(n==null){n=""}e.destination=t;return this._transmit("SEND",e,n)};o.prototype.subscribe=function(t,e,n){var i;if(n==null){n={}}if(!n.id){n.id="sub-"+this.counter++}n.destination=t;this.subscriptions[n.id]=e;this._transmit("SUBSCRIBE",n);i=this;return{id:n.id,unsubscribe:function(){return i.unsubscribe(n.id)}}};o.prototype.unsubscribe=function(t){delete this.subscriptions[t];return this._transmit("UNSUBSCRIBE",{id:t})};o.prototype.begin=function(t){var e,n;n=t||"tx-"+this.counter++;this._transmit("BEGIN",{transaction:n});e=this;return{id:n,commit:function(){return e.commit(n)},abort:function(){return e.abort(n)}}};o.prototype.commit=function(t){return this._transmit("COMMIT",{transaction:t})};o.prototype.abort=function(t){return this._transmit("ABORT",{transaction:t})};o.prototype.ack=function(t,e,n){if(n==null){n={}}n["message-id"]=t;n.subscription=e;return this._transmit("ACK",n)};o.prototype.nack=function(t,e,n){if(n==null){n={}}n["message-id"]=t;n.subscription=e;return this._transmit("NACK",n)};return o}();i={libVersion:"2.0.0-next",VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(t,n){var o,r;if(n==null){n=["v10.stomp","v11.stomp"]}o=i.WebSocketClass||WebSocket;r=new o(t,n);return new e(r)},over:function(t){return new e(t)},Frame:n};if(typeof window!=="undefined"&&window!==null){window.Stomp=i}else if(typeof exports!=="undefined"&&exports!==null){exports.Stomp=i;i.WebSocketClass=require("./test/server.mock.js").StompServerMock}else{self.Stomp=i}}.call(this);